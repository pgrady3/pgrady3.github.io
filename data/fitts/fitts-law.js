"use strict";function makeDimension(t,e,i,s,n,r){return{width:t,height:e,innerWidth:t-(r+s),innerHeight:e-(i+n),top:i,right:s,bottom:n,left:r,cx:(t-(r+s))/2+r,cy:(e-(i+n))/2+i}}function rHit(t,e){return plotHitsDimension.innerWidth/2/e*t}function v(t){return"rgb("+clampInt(0,255,t/MAX_SPEED*255)+", 0, 0)"}function randomAB(t,e){return t+Math.random()*(e-t)}function mouseMoved(){var t=d3.svg.mouse(this);fittsTest.mouseMoved(t[0],t[1])}function mouseClicked(){var t=d3.svg.mouse(this);fittsTest.mouseClicked(t[0],t[1])}function distance(t,e){var i=t.x-e.x,s=t.y-e.y;return Math.sqrt(Math.pow(i,2)+Math.pow(s,2))}function clampInt(t,e,i){return Math.min(e,Math.max(t,Math.floor(i)))}function bgRect(t,e){return t.append("rect").attr("cx",0).attr("cy",0).attr("width",e.width).attr("height",e.height).attr("class","back")}function startTimer(){function t(i){e||(e=i),elapsed=i-e,timer.innerText=(elapsed/1e3).toFixed(2),fittsTest.active?window.requestAnimationFrame(t):console.log("stop timer")}let e=null;console.log("start timer"),window.requestAnimationFrame(t)}function startExperience(){startScreen.style.display="none",experienceScreen.style.display="",fittsTest.advanceParams()}function endExperience(){experienceScreen.style.display="none",startScreen.style.display="",startText.innerText=`${(elapsed/1e3).toFixed(2)} seconds\n`+startText.innerText,fittsTest.currentPosition=0,fittsTest.currentCount=0,fittsTest.miss=0,fittsTest.active=!1,timer.innerText="",testAreaSVG.selectAll("line").remove(),fittsTest.advanceParams()}var testDimension=makeDimension(620,400,30,30,30,30),MAX_SPEED=2,elapsed=0;const experienceScreen=document.getElementById("experience-screen"),startScreen=document.getElementById("start-screen"),startButton=document.getElementById("start-button"),timer=document.getElementById("timer"),startText=document.getElementById("start-text");var fittsTest={target:{x:0,y:0,r:10},start:{x:0,y:0,t:0},last:{},isoPositions:[],currentPosition:0,currentCount:0,miss:0,isoLimits:{minD:120,maxD:300,minW:10,maxW:100},isoParams:{num:9,distance:200,width:50,randomize:!0},active:!1,data:[],colour:d3.scale.category10(),generateTarget:function(){this.target=this.isoPositions[this.currentPosition],this.target.distance=this.isoParams.distance;var t=testAreaSVG.selectAll("#target").data([this.target]),e=function(t){t.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",function(t){return t.w/2})};t.enter().append("circle").attr("id","target").style("fill","red").call(e),t.transition().call(e)},updateISOCircles:function(){this.generateISOPositions(this.isoParams.num,this.isoParams.distance,this.isoParams.width);var t=testAreaSVG.selectAll("circle").data(this.isoPositions),e=function(t){t.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",function(t){return t.w/2})};t.enter().append("circle").attr("class","iso").call(e),t.transition().call(e),t.exit().transition().attr("r",0).remove(),this.generateTarget()},generateISOPositions:function(t,e,i){this.isoPositions=[];for(var s=0;s<t;s++)this.isoPositions[s]={x:testDimension.cx+e/2*Math.cos(2*Math.PI*s/t),y:testDimension.cy+e/2*Math.sin(2*Math.PI*s/t),w:i}},removeTarget:function(){testAreaSVG.selectAll("#target").data([]).exit().remove()},mouseClicked:function(t,e){distance({x:t,y:e},this.target)<this.target.w/2?(this.active||(console.log("start active"),startTimer(),this.active=!0),this.currentCount++,this.currentPosition=(this.currentPosition+Math.ceil(this.isoPositions.length/2))%this.isoPositions.length,this.removeTarget(),this.generateTarget(),0===this.currentPosition&&this.advanceParams(),9===this.currentCount&&(this.active=!1,endExperience()),this.last={x:t,y:e,t:(new Date).getTime()},this.start=this.last):this.miss++},mouseMoved:function(t,e){if(this.active){if(t==this.last.x&&e==this.last.y)return;if(0===Object.keys(this.last).length)return;var i={x:t,y:e,t:(new Date).getTime()},s=i.t-this.last.t;distance(this.last,{x:t,y:e});if(s>0);else;this.last=i}},advanceParams:function(){console.log("advance params, current count: "+this.currentCount),this.isoParams.distance=200,this.isoParams.width=50,this.updateISOCircles()}},testAreaSVG=d3.select("#test-area").append("svg").attr("width",testDimension.width).attr("height",testDimension.height).style("pointer-events","all").on("mousemove",mouseMoved).on("mousedown",mouseClicked).call(bgRect,testDimension);startButton.addEventListener("click",startExperience);